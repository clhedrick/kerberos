.TH CREDSERV 8
.SH NAME
credserv \- provide Kerberos credentials from keytab stored to remote client
.SH SYNOPSIS
.B credserv
[ -d ]
.SH DESCRIPTION
.I  kgetcred
is designed for cron jobs or services that need access to Kerberos
credentials, but don't have an interactive user to supply them.
Kgetcred sends a request to a credserv server. The server stores
its data in LDAP. It uses two attributes.
.PP
csRutgersEduCredservRule can have multiple values. The values look like
.PP
host:principal:flags
.PP
where flags is optional. Currently the only supported option is F, for
forwardable. Each value indicatest that the user is permitted to 
get credentials for that principal on that host. The F option indicates
that the credentials should be forwardable. 
.PP
* in the host field will apply to all hosts
.PP
csRutgersEduCredservKeytab stores key tables. There is a separate entry
for each principal that appears in a rule. The value will be of the form
.pp
smith@CS.RUGTGERS.EDU=nnnnnn
.PP
where nnnnn is a key table encoded in base64.
.PP
Because anonymous kinit isn't supported on all systems yet, and it's
needed to armor requests for one-time passwords, this service
also provides a way to get anonymous credentials. If you want to support
this, put a keytab for "anonymous.user"  in /etc/krb5.anonymous.keytab
This user should be added to the system with a random password. It should
not have any privileges, and shouldn't be allowed to login anywhere.
(This username is built into both kgetcred and credserv.)
.PP
Credserv normally detaches from the terminal, and logs to syslog.
If -d is supplied it remains attached to the terminal, and prints
debug and error messasges there.
.PP
Kgetcred can authenticate itself in several ways: for getting
credentials (the default operation), it uses the client's
host principal, from /etc/krb5.keytab. For other operations it uses the the user's own credentials. Privileged
users may kinit as an admin principal.
.PP
Where host prnicipals are used, 
credserv verifies that the hostname in the principal matches the IP
address from which the request came.
.PP
Kgetcred can also register and unregister principals. Privileged
users (users in the admin group; see below) may change any
user. The protocol allows user, principal and flags to be passed.
But unprivileged users must have user and principal match the
principal by which they are authenticated, and they may not
specify flags.
.PP
There should be an entry for credserv in the [appdefaults]
section of /etc/krb5.conf. The most common parameters are
.PP
.nf
[appdefaults]
credserv= {
    ldapurl=ldaps://krb1.cs.rutgers.edu,ldaps://krb2.cs.rutgers.edu
    ldapbase=cn=accounts,dc=cs,dc=rutgers,dc=edu
}
.fi
.PP
where ldapurl points to the LDAP server. If omitted you'll get
ldaps://localhost, which may well be appropriate. ldapbase
is the search base for user lookups.
.PP
If you want to be able to do privileged operations, put the
users who are authorized into a group, and then add the name of the group to
/etc/krb5.conf, e.g.
.PP
.nf
[appdefaults]
credserv = {
     admingroup = credadmin
}
.fi
.PP
Note that credserv will actually check the Kerberos principal sent
by kgetcred for the user, not the user's uid. So if you are logged
in as user and kinit as user.admin, credserv will check user.admin.
Because full principals can't appear in groups, you'll want to use
user.admin, not user/admin.
.PP
NOTE: You must make a service principal for credserv/HOST on the server
and add it to /etc/krb5.keytab.
.SH "OPTIONS"
.TP
.B \-d
do not detach, and print debugging messages
.SH "SEE ALSO"
kgetcred(1)
.SH "IMPLEMENTATION NOTES"
Currently the code isn't designed to handle a redundant server. That would be
easy to add, but you'd need to synchronize data on the two servers.
.PP
Currently credserv must be run on the Kerberos server, because it uses
kadmin.local to generate keytabs. This restriction could be removed if the
client sent the user's password to the server. Then ktutil could be
used to make keytabs. However the password would need to be encrypted,
and I'm not convinced I'm competent to do that design.


